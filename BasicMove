#include <Adafruit_MCP3008.h>
Adafruit_MCP3008 adc1;
Adafruit_MCP3008 adc2;
const unsigned int ADC_1_CS = A3;
const unsigned int ADC_2_CS = A2;
const unsigned int RF_CS = A4;
const unsigned int M1_IN_1 = 2;
const unsigned int M1_IN_2 = 3;
const unsigned int M2_IN_1 = 5;
const unsigned int M2_IN_2 = 4;
const unsigned int M1_I_SENSE = A1;
const unsigned int M2_I_SENSE = A0;
const float M_I_COUNTS_TO_A = (3.3 / 1024.0) / 0.120;
const unsigned int PWM_VALUE = 255;
unsigned int motor1=40;//left?
unsigned int motor2=40; //right?



void setup() {
  // put your setup code here, to run once:
Serial.begin(115200);
  pinMode(M1_IN_1, OUTPUT);
  pinMode(M1_IN_2, OUTPUT);
  pinMode(M2_IN_1, OUTPUT);
  pinMode(M2_IN_2, OUTPUT);
  pinMode(RF_CS, OUTPUT);
  digitalWrite(RF_CS, HIGH); // Without this the nRF24 will write to the SPI bus
                             // while the ADC's are also talking
  adc1.begin(ADC_1_CS);  
  adc2.begin(ADC_2_CS);
  int savedadc[13];
  delay(2000);
  MoveForward(); //Start Moving
  }

void loop() {
  int savedadc[13];
  int check=0;
  // put your main code here, to run repeatedly:
  check=SensorRead(savedadc);
  if(check>3){
  JunctionCheck();
  }
  else{
    //MoveForward();
  }
//LineCorrection();


  
}



int SensorRead(int (& linesense)[13]){
  int amount=0;
  for (int i = 0; i < 8; i++) {
    if((adc1.readADC(i))<700){
    linesense[i] = 1;
    amount++;
    }
    else{
    linesense[i] = 0;
    }
    if(i<6){
      if((adc2.readADC(i))<700){
      linesense[i+8] = 1;
      amount++;
      }
      else{
      linesense[i+8] = 0;
      }
    }
  }
   return(amount);
  }


  void JunctionCheck(){
    Serial.println("Junction Detected");
    delay(50);
    StopMotor();

    
  }

  void MoveForward(){
  analogWrite(M1_IN_1, 0);
  analogWrite(M1_IN_2, motor1);
  analogWrite(M2_IN_1, 0);
  analogWrite(M2_IN_2, motor2);
  }

  

  void StopMotor(){
   analogWrite(M1_IN_1, 0);
  analogWrite(M1_IN_2, 0);
  analogWrite(M2_IN_1, 0);
  analogWrite(M2_IN_2, 0);
  }
